
Question 2: SQL Challenge 

# While doing this challenge I observed that `sql try editor` 
# works differently on Chrome and Safari.  While Chrome supports Clauses like
LIMIT and returns multiple columns from a subquery , the Safari version doesnt.

This made me ask myself "Is SQL try Editor dialect dependent on different browsers?"
This resulted in me using only queries that worked on both browsers.

---------------------------------------------------------------------
a. How many orders were shipped by Speedy Express in total?

Process: I left joined the Shippers table with the Orders table on ShipperID
        then filtered for shippername "Speedy Express". I retrieved the count for 
        the number of orders made using the Speedy Express.

    query : 
    SELECT COUNT(*) AS "Number of Orders by Speedy Express" 
        FROM Orders o
        LEFT JOIN Shippers sh
        ON sh.ShipperID = o.ShipperID
        WHERE 
        ShipperName = 'Speedy Express'

    Answer: 54
-------------------------------------------------------------------------

b. What is the last name of the employee with the most orders?

Process: For this task I want to use the LIMIT clause and I couldn't in Safari.
        I decided to use a solution that works for both Chrome and Safari (which I find strange).

        I used subqueries to retrieve the last name by joining on
        the Orders and Employees tables to get a last name and counting the order id.
        I grouped them by lastname. I was able to retrieve the maximum
        orders made in the second part of the query. I did a last subquery to retrieve the lastname
        having the same value as the maximum order count

    query:
     SELECT  LastName
            FROM Orders o
            LEFT JOIN Employees em
            ON em.employeeID = o.employeeID
            GROUP BY em.LastName        
            HAVING COUNT (o.OrderID)=

            (SELECT MAX(count_order) 
                FROM
            (
            SELECT  Count(o.OrderID) as count_order
            FROM Orders o
            LEFT JOIN Employees em
            ON em.employeeID = o.employeeID
            GROUP BY em.LastName))

        
    Answer: Peacock
-----------------------------------------------------------------

c. What product was ordered the most by customers in Germany?

Process: For this task I want to use the LIMIT clause and I couldn't in Safari.
        I decided to use a solution that works for both Chrome and Safari (which I find strange).

        I used subqueries to retrieve the productName by joining on
        the OrderDetails and Products tables. I joined the Customer and Order table to filter
        for orders made in Germany. I then filtered the two newly created tables on OrderID, to
        retrieve orderdetails and products details only from Germany.
        I repeated the whole steps to create two Queries.

        In the first repeated subqueries, I selected only the productname conditioned that it has
        an order count equal to the maximum order of the second repeated subquery. I was able to 
        retrieve the information.
        

    query: 
       
        SELECT p.ProductName
        FROM 
            OrderDetails as od
            LEFT JOIN Products as p
            ON od.ProductID = p.ProductID
            WHERE od.OrderID = ANY

            (SELECT o.OrderID
            FROM Customers cm
            LEFT JOIN Orders o ON cm.CustomerID = o.CustomerID
            WHERE cm.Country = 'Germany')
            GROUP BY ProductName

            HAVING COUNT(*) = 
            (SELECT MAX(count_order) 
                            FROM
                        (
        SELECT COUNT(*) as count_order , p.ProductName
        FROM 
            OrderDetails as od
            LEFT JOIN Products as p
            ON od.ProductID = p.ProductID
            WHERE od.OrderID = ANY
            (SELECT o.OrderID
            FROM Customers cm
            LEFT JOIN Orders o ON cm.CustomerID = o.CustomerID
            WHERE cm.Country = 'Germany')
        GROUP BY ProductName
        ORDER BY Count(*) DESC))

-----------------------------------------------------------------